import{d as $,r as c,C as x,o as T,c as i,f as o,F as C,D as g,z as y,s as D,G as B,H as K,A as u,I as M,J as A,e as v,K as N,L as E,_ as H}from"./index-qUL-dtZK.js";import{s as _}from"./request-d3lUv3oy.js";import{A as b}from"./_prefix-Cw2jshfM.js";const L=s=>_.post(`${b}/table/create`,s,{headers:{"Content-Type":"application/json"}}),U=s=>_.post(`${b}/ask`,s,{headers:{"Content-Type":"application/json"}}),j=s=>_.get(`${b}/table/user/${s}`),z=(s,l)=>_.get(`${b}/table/${s}/${l}`),F=s=>(M("data-v-88394f4b"),s=s(),A(),s),V={class:"chat-container"},q={class:"sidebar"},G=F(()=>o("h2",null,"会话",-1)),J=["onClick"],O={class:"main"},Q={class:"chat-header"},P={class:"chat-body"},R={class:"chat-input"},W=["onKeydown"],X=["disabled"],Y=$({__name:"Dashboard",setup(s){const l=c(localStorage.getItem("userId")||""),r=c([]),d=c(""),h=c([]),p=c(""),f=c(!1),k=x(()=>{const e=r.value.find(t=>t.tableId===d.value);return e?e.tableName:"New Chat"}),m=async()=>{const e=await j(l.value);e.data.code==="200"?r.value=e.data.data.map(t=>{var a;return{tableId:String(t.tableId),tableName:((a=t.tableName)==null?void 0:a.trim())||"New Chat"}}):u.error(e.data.msg||"获取历史对话失败")},I=async e=>{const t=await z(l.value,e);t.data.code==="200"?(d.value=e,h.value=t.data.data.map((a,n)=>({sender:n%2===0?"user":"ai",text:a}))):u.error(t.data.msg||"加载对话内容失败")},w=async()=>{const e=p.value.trim();if(!(!e||!d.value)){h.value.push({sender:"user",text:e}),p.value="",f.value=!0;try{const t=await U({userId:l.value,tableId:d.value,question:e});if(t.data.code==="200"){t.data.data.content.forEach(n=>{h.value.push({sender:"ai",text:n})});const a=r.value.find(n=>n.tableId===d.value);a&&a.tableName==="New Chat"&&await m()}else u.error(t.data.msg||"提问失败")}catch{u.error("请求出错")}finally{f.value=!1}}},S=async()=>{const e=await L({userId:l.value});e.data.code==="200"?(await m(),await I(e.data.data)):u.error("新建对话失败")};return T(async()=>{await m(),r.value.length>0&&await I(r.value[0].tableId)}),(e,t)=>(v(),i("div",V,[o("aside",q,[o("div",{class:"sidebar-header"},[G,o("button",{class:"circle-btn",onClick:S},"＋")]),(v(!0),i(C,null,g(r.value,a=>(v(),i("div",{class:N(["chat-list-item",{active:a.tableId===d.value}]),key:a.tableId,onClick:n=>I(a.tableId)},y(a.tableName),11,J))),128))]),o("main",O,[o("div",Q,y(k.value),1),o("div",P,[(v(!0),i(C,null,g(h.value,(a,n)=>(v(),i("div",{class:N(["message",{self:a.sender==="user"}]),key:n},y(a.text),3))),128))]),o("div",R,[D(o("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>p.value=a),onKeydown:K(E(w,["prevent"]),["enter"]),placeholder:"输入消息..."},null,40,W),[[B,p.value]]),o("button",{onClick:w,disabled:f.value},"发送",8,X)])])]))}}),te=H(Y,[["__scopeId","data-v-88394f4b"]]);export{te as default};
